{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
  <div class="row g-3">

    <!-- ستون توضیحات و نهایی کردن سمت چپ -->
    <div class="col-md-8">
      <div class="card h-100 p-3">
        <h5 class="mb-3">توضیحات سفارش</h5>
        <p>{{ order.description }}</p>

        {% if not order.finalized %}
          <!-- بخش تعیین میزان گلد و نهایی کردن -->
          <form method="post">
            {% csrf_token %}
            <div class="mb-2">
              <label for="gold_input" class="form-label">میزان گلدی که میخوای بدی:</label>
              <input type="number" id="gold_input" name="gold_amount" class="form-control"
                     min="{{ order.min_reserve }}" max="{{ order.amount }}" step="{{ order.min_reserve }}">
            </div>
            <button type="submit" class="btn btn-primary">نهایی کردن فروش</button>
          </form>
        {% else %}
          <!-- نام خریدار و باکس آپلود -->
          <p class="mt-3"><strong>خریدار:</strong> {{ order.buyer }}</p>

          <div class="card p-3 mt-2">
            <h5 class="mb-2">آپلود ویدیو</h5>
            <form method="post" enctype="multipart/form-data">
              {% csrf_token %}
              <input type="file" name="video" class="form-control mb-2" accept="video/*">
              <button type="submit" class="btn btn-success">شروع آپلود</button>
            </form>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- ستون اطلاعات سفارش سمت راست -->
    <div class="col-md-4">
      <div class="card h-100 p-3 text-center">
        {% if order.faction == 'horde' %}
          <img src="{% static 'images/horde.png' %}" class="img-fluid mb-3" style="max-height:100px;" alt="Horde">
        {% else %}
          <img src="{% static 'images/alliance.png' %}" class="img-fluid mb-3" style="max-height:100px;" alt="Alliance">
        {% endif %}

        <h5 class="mb-3">اطلاعات سفارش</h5>
        <h6 class="card-title mb-1">{{ order.title }}</h6>
        <p class="mb-0"><strong>{% with order.expansion.all|first as exp %}{{ exp.name }}{% endwith %}</strong> :اکسپنشن</p>
        <p class="mb-0"><strong>{{ order.realm }}</strong> :ریلم</p>
        <p class="mb-1"><strong>{{ order.region }}</strong> :ریجن</p>
        <p class="mb-1"><strong>{{ order.amount }}</strong> :مقدار گلد</p>
        <p class="mb-1"><strong>{{ order.min_reserve }}</strong> :حداقل رزرو</p>
        <p class="mb-1"><strong>{{ order.price_per_1k }}</strong> :قیمت هر k</p>
        <p class="mb-1"><strong>{{ order.status }}</strong> :وضعیت</p>
      </div>
    </div>

  </div>
</div>
{% endblock %}
