{% extends "base.html" %}
{% load static %}

{% block content %}
    <div class="container mt-4" dir="rtl">

        <div class="row g-4">

            <!-- ستون راست: اطلاعات مربی -->
            <div class="col-md-4">
                <div class="card p-3 shadow-sm text-end">

                    <h4 class="fw-bold">{{ coach.user.username }}</h4>

                    <!-- نمایش expansions -->
                    <p><strong>اکسپنشن‌ها:</strong>
                        {% for expansion in coach.expansions.all %}
                            {{ expansion.name }}{% if not forloop.last %}, {% endif %}
                        {% empty %}
                            ندارد
                        {% endfor %}
                    </p>

                    <!-- نمایش methods -->
                    <p><strong>نوع فعالیت‌ها:</strong>
                        {% for method in coach.methods.all %}
                            {{ method.name }}{% if not forloop.last %}, {% endif %}
                        {% empty %}
                            ندارد
                        {% endfor %}
                    </p>

                    <p class="mb-1">
                        <strong>تایم پلی:</strong> {{ coach.timeplay }} ماه
                    </p>
                    <p class="mb-1">
                        <strong>ایدی دیسکورد:</strong> {{ coach.user.discord_id }}
                    </p>

                    <a href="mailto:{{ coach.user.email }}"
                       class="btn btn-primary w-100 mt-2">
                        ارتباط با مربی
                    </a>

                </div>
            </div>

            <!-- ستون چپ: توضیحات -->
            <div class="col-md-8">
                <div class="card p-4 shadow-sm">

                    <h5 class="mb-3 fw-bold">درباره مربی</h5>

                    <p style="line-height: 1.9;">
                        {{ coach.description }}
                    </p>

                </div>
            </div>

        </div>

        <!-- بخش کامنت‌ها -->
        <div class="row mt-5">
            <div class="col-md-12">

                <div class="card p-4 shadow-sm">

                    <h5 class="fw-bold mb-3">کامنت‌ها</h5>

                    <!-- نمایش کامنت‌های تأیید شده -->
                    {% for c in coach.comments.all %}
                        {% if c.enable %}
                            <div class="border rounded p-3 mb-3 bg-light">

                                <div class="d-flex justify-content-between">
                                    <strong>{{ c.user.username }}</strong>
                                    <small class="text-muted">{{ c.created_at|date:"Y/m/d H:i" }}</small>
                                </div>

                                <p class="mt-2 mb-0" style="white-space: pre-line;">
                                    {{ c.text }}
                                </p>

                            </div>
                        {% endif %}
                    {% empty %}
                        <p class="text-muted">فعلاً هیچ کامنتی ثبت نشده.</p>
                    {% endfor %}

                    <hr class="my-4">

                    <!-- فرم ارسال کامنت -->
                    {% if user.is_authenticated %}
                        <h6 class="fw-bold mb-2">ارسال کامنت جدید</h6>

                        <form method="post">
                            {% csrf_token %}
                            <textarea name="text"
                                      rows="4"
                                      class="form-control mb-2"
                                      placeholder="نظر خود را وارد کنید..."></textarea>

                            <button class="btn btn-success w-100">
                                ارسال کامنت
                            </button>
                        </form>

                    {% else %}
                        <p class="text-danger">
                            برای ارسال کامنت ابتدا باید وارد شوید.
                        </p>
                    {% endif %}

                </div>

            </div>
        </div>

    </div>
{% endblock %}
